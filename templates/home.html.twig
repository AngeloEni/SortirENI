{% extends 'base.html.twig' %}
  {% block body %}
      <div class="container-fluid">
      <div class="container">
          <div class="row">
              <div class="col-md-9"></div>
              <div class="col-md-3">
                  <h5>Date du jour : {{ now| date('d-m-Y') }}</h5>
                  <h5>Participant: {{ user.fullname }}</h5>
              </div>
          </div>
      </div>
      <div class="row">
      <div class="col-md-6">
          <h2 class="mb-5">Filtrer les sorties</h2>
          {# form #}
          {{ form_start (form) }}

          {{ form_widget (form) }}
      </div>
      <div class="col-md-4">

          <div class="m-3">

              <div class="col-md-2">
                  <button class="btn btn-primary btn-lg mt-5" type="submit">
                      Search
                  </button>
              </div>
          </div>
      </div>
      {{ form_end (form) }}
      <div class="container-fluid">
          <div class="row">
              <div class="col-xs-12 ">
                  <div class="overflow-auto">
                      <table class="table table-striped table-hover ">
                          <thead>
                          <tr>
                              <th scope="col">Nom de la sortie</th>
                              <th scope="col">Date de la sortie</th>
                              <th scope="col">Clôture</th>
                              <th scope="col">Inscrits/places</th>
                              <th scope="col">Etat</th>
                              <th scope="col">Instrit(e)</th>
                              <th scope="col">Organisateur</th>
                              <th scope="col">Actions</th>
                          </tr>
                          </thead>
                          <tbody>
                          <tr>
                              {% for e in events %}
                              <td>{{ e.name }}</td>
                              <td>{{ e.dateTimeStart| date('d-m-Y') }}</td>
                              <td>{{ e.registrationClosingDate| date('d-m-Y') }}</td>
                              <td>{{ e.Participants|length }}/{{ e.maxParticipants }}</td>
                              <td>{{ e.Status.description }}</td>
                              {% if user in e.participants %}
                                  <td>Inscrit</td>
                              {% else %}
                              <td></td>
                              {% endif %}
                              <td>{{ e.getOrganizer().getFullname() }}</td>


                              {% if e.Status.description == "Ongoing" or
                                    e.Status.description == "Closed" or
                                    e.Status.description == "Open" or
                                    e.Status.description == "Cancelled" or
                                    e.Status.description == "Ended" %}
                              <td><a class="nav-link" href="{{ path('app_event', {id:e.id}) }}">Afficher</a></td>
                                    {% if user in e.participants and (e.Status.description == "Open" or e.Status.description == "Closed") %}
                                        <td><a class="nav-link" href="{{ path('unregister_for_revent', {id:e.id}) }}"> Se desister</a></td>
                                    {% elseif e.Status.description == "Open" and user in e.participants == false and e.getOrganizer() != user %}
                                        <td><a class="nav-link" href="{{ path('register_for_revent', {id:e.id}) }}"> S'inscrire</a></td>
                                    {% endif %}

                              {% endif %}


                              {% if e.Status.description == "Created" and e.getOrganizer() == user%}
                                  <td><a class="nav-link" href="#">Modifier</a></td>
                                  <td><a class="nav-link" href="#">Publier</a></td>
                              {% endif %}

                              {% if e.Status.description == "Open" and e.getOrganizer() == user%}
                              <td><a class="nav-link" href="#">Annuler</a></td>
                              {% endif %}

                           {# j'utilise ça pour tester le edit en attendant que les status aient du sens :-)
                             <td><a href="{{path('editEvent', {id:e.id})}}"class="nav-link">Modifier</a></td>
                              <td><a href="{{path('cancelEvent', {id:e.id})}}"class="nav-link">Cancel</a></td>#}

                          </tr>
                          {% endfor %}
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>
      </div>

      <div class="m-3">
          <a href="{{path('addEvent')}}"  class="btn btn-primary btn-lg mt-5">Créer une sortie</a>
      </div>
  {% endblock %}